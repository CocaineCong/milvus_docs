## 位集合

本主题介绍位集合机制，该机制有助于启用 Milvus 中的关键功能，如[时间旅行](timetravel_ref.md) 、属性过滤和[删除操作](https://milvus.io/blog/2022-02-07-how-milvus-deletes-streaming-data-in-distributed-cluster.md)。

概览

位集合是一组位。位是只有两个可能值的元素，最常见的是 `0` 和 `1` ，或布尔值 `true` 和 `false` 。在 Milvus 中，位集合是由位数 `0` 和 `1` 的数组构成，可用于紧凑且高效地表示一些数据，而不是使用整型，浮点型或字符型。位数默认为`0`，只有在满足某些条件时才设置为`1`。

位集合的操作使用[布尔逻辑](boolean.md)进行，根据该逻辑，输出值要么是有效的，要么是无效的，分别用 `1` 和 `0` 表示。例如，[逻辑运算符](https://milvus.io/docs/v2.1.x/boolean.md#Logical-operators) `AND` 可以用于基于位集合中的相同索引位置上的元素进行比较，并生成一个带有结果的新位集合。如果一个位置上的两个元素是相同的，则在新的位集合中将在该位置上写入 `1` ；如果它们不同，则写入 `0` 。

实现

位集用作简单但功能强大的机制，有助于 Milvus 执行属性过滤、数据删除和时间旅行查询。

### 属性过滤

由于位集只包含两种可能的值，因此它们非常适合存储满足给定属性过滤器要求的数据的结果。满足给定属性过滤器要求的数据被标记为 `1`。

### 数据删除

位集用作一种紧凑的方式来存储有关部分中行是否已删除的信息。相应位集中的已删除实体用 `1` 标记，搜索或查询过程中将不会对其进行计算。

### 时间旅行查询

使用时间旅行进行搜索时，Milvus 使用位集合存储关于段中的数据是否满足 `travel_timestamp` 要求的信息。如果它们的时间戳大于或等于该要求，则将数据标记为 `1`，这意味着它们在指定时间出现。关于时间旅行的确切过程更加复杂，以便使其尽可能高效。有关更多信息，请参见[时间戳的位集合](https://milvus.io/docs/v2.1.x/timetravel_ref.md#Bitset-for-timestamp)。

示例

这里我们提供三个示例，说明了在 Milvus 中如何使用位集，同时提到了上面讨论过的三个主要的位集实现。在所有的三种情况中，都有一个包含 8 个实体的段，然后按照下面的顺序进行数据操作语言（DML）事件。

- 当时间戳 `ts` 等于 100 时，插入了 4 个实体，它们的 `primary_key` 分别为 `[1,2,3,4]`。

- 当时间戳 `ts` 等于 200 时，插入了其余 4 个实体，它们的 `primary_key` 分别为 `[5,6,7,8]`。

- 当时间戳 `ts` 等于 300 时，实体的 `primary_key` 为 `[7, 8]` 的删除操作。

- 只有 `primary_key` 为 `[1, 3, 5, 7]` 的实体

#### 属性过滤示例

假设需要对 Milvus 中的 8 个实体进行属性过滤，其中只有 `primary_key` 为奇数的实体应包含在结果中。可以使用位集合轻松实现此操作。首先，创建一个新的 8 位位集合，所有 8 个位初始化为 `0`。然后，将 `1` 标记分配给所有具有奇数 `primary_key` 的实体相应的位：

```
bit_set = [1, 0, 1, 0, 1, 0, 0, 0]
```
在返回结果时，只需检查哪些位的标记为 `1`，然后返回相应位置上对应的实体即可。

#### 数据删除示例

假设我们要删除 `primary_key` 为 `7` 和 `8` 的两个实体。可以使用 8 位位集合实现此操作，其中 7 和 8 所对应的位值设置为 `1`。在 Milvus 中，位集合被编码为字符串，该字符串可以作为流式数据 API 中删除操作的参数：

```
bit_set = "00000011"
```

#### 时间旅行示例

假设需要返回任何在时间 `t = 250` 或更早时插入到 Milvus 中的实体。可以使用 8 位位集合实现此操作，其中 `travel_timestamp` 大于等于 250 的所有实体所对应的位都设置为 `1`。类似于数据删除示例中的实现，位集合被编码为字符串，该字符串可以作为 stream data API 的参数：

```
bit_set = "00111111"
```

在这个例子中，所有位都被设置为了 `1`，因为所有实体在 250 之前都已插入，因此它们都是符合要求的。

# 下一步操作

现在，您已经了解了 Milvus 中位集合的工作原理，您可能还想要：

* 学习如何[使用字符串进行过滤](https://milvus.io/blog/2022-08-08-How-to-use-string-data-to-empower-your-similarity-search-applications.md) 以过滤您的搜索结果，或者参考我们文档中的[混合搜索](https://milvus.io/docs/v2.1.x/hybridsearch.md)。

* 了解关于如何[使用时间旅行进行搜索](https://milvus.io/docs/v2.1.x/timetravel.md) 的更多信息。

* 了解 Milvus 中[数据是如何处理的](https://milvus.io/docs/v2.1.x/data_processing.md)。