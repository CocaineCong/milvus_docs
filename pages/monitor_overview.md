Milvus 监控框架概述
=============

本主题介绍 Milvus 如何使用 Prometheus 监控指标以及使用 Grafana 可视化指标和创建警报。

Prometheus in Milvus
--------------------

[Prometheus](https://prometheus.io/docs/introduction/overview/) 是一个用于 Kubernetes 实现的开源监控和警报工具包。它将指标作为时间序列数据进行收集和存储。这意味着在记录时，指标会带有时间戳，并附带可选的键值对标签。

目前 Milvus 使用了 Prometheus 的以下组件：

* 从由出口器设置的端点中提取数据的Prometheus端点。

* Prometheus操作员，有效地管理Prometheus监控实例。

* Kube-prometheus，提供易于操作的端到端Kubernetes集群监控。

### 指标名称

Prometheus中的有效指标名称包含三个元素：名称空间、子系统和名称。这三个元素用“_”连接。

Prometheus监控的Milvus指标的命名空间是“milvus”。根据指标所属的角色，其子系统应该是以下八个角色之一：“rootcoord”，“proxy”，“querycoord”，“querynode”，“indexcoord”，“indexnode”，“datacoord”，“datanode”。

例如，计算查询向量总数的Milvus指标名为`milvus_proxy_search_vectors_count`。

### 指标类型

Prometheus支持四种指标类型：

* 计数器：一种累积指标类型，其值只能增加或在重新启动时重置为零。

* Gauge: a type of metrics whose value can either go up and down.

* Histogram: a type of metrics that are counted based on configurable buckets. A common example is request duration.

* Summary: a type of metrics similar to histogram that calculates configurable quantiles over a sliding time window.

### Metric labels

Prometheus通过标签来区分具有相同指标名称的样本。 标签是指标的某些属性。 同名指标必须对`variable_labels`字段具有相同的值。 以下表格列出了Milvus指标常见标签的名称和含义。

| Label name | Definition | Values |
| --- | --- | --- |
| "node_id" | The unique identity of a role. | A globally unique ID generated by milvus. |
| "status" | The status of a processed operation or request. | "abandon", "success", or "fail". |
| “query_type” | The type of a read request. | "search" or "query". |
| "msg_type" | The type of messages. | "insert", "delete", "search", or "query". |
| "segment_state" | The status of a segment. | "Sealed", "Growing", "Flushed", "Flushing", "Dropped", or "Importing". |
| "cache_state" | The status of a cached object. | "hit" or "miss". |
| "cache_name" | The name of a cached object. This label is used together with the label "cache_state". | Eg. "CollectionID", "Schema", etc. |
| “channel_name" | Physical topics in message storage (Pulsar or Kafka). | Eg."by-dev-rootcoord-dml_0", "by-dev-rootcoord-dml_255", etc. |
| "function_name" | The name of a function that handles certain requests. | Eg. "CreateCollection", "CreatePartition", "CreateIndex", etc. |
| "user_name" | The user name used for authentication. | A user name of your preference. |
| "index_task_status" | The status of an index task in meta storage. | "unissued", "in-progress", "failed", "finished", or "recycled". |

Milvus中的Grafana
---------------

[Grafana](https://grafana.com/docs/grafana/latest/introduction/)是一个开源的可视化堆栈，可以连接所有数据源。通过提取指标，它帮助用户理解、分析和监控大规模数据。

Milvus使用Grafana的可定制仪表板进行指标可视化。

接下来是什么
------

在了解监控和报警的基本工作流程之后，请学习：

* [部署监控服务](monitor.md)

* [可视化Milvus指标](visualize.md)

* [创建警报](alert.md)
