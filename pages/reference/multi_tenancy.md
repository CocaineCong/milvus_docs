---
id: multi_tenancy.md
related_key: multi-tenancy
summary: Multi-tenancy in Milvus.
title: Multi-tenancy strategies
---

# 多租户策略

随着 ChatGPT 的普及，越来越多的开发者正在使用 CVP（ChatGPT、向量数据库、提示）堆栈创建自己的 SaaS 服务。本指南解释了如何在世界上使用最广泛的向量数据库之一 Milvus 上实现多租户，以跟上这一趋势。

多租户是一种架构，其中单个 Milvus 实例服务于多个租户。区分租户的最简单方法是通过将他们的数据和资源与其他人的数据和资源分开。每个租户都有自己的专用资源或与其他租户共享资源，以管理 Milvus 对象，如数据库、集合和分区。基于这些对象，有相应的方法来实现 Milvus 多租户。

## 数据库导向的多租户

从 Milvus 版本 2.2.9 开始，现在可以使用对象数据库。你可以在单个 Milvus 集群中创建多个数据库。这个新功能通过为每个租户分配一个数据库，使他们可以创建自己的集合和分区以充分利用他们的数据，从而实现数据库导向的多租户。然而，这种策略确保了租户的数据隔离和搜索性能，但可能会在空闲租户上浪费资源。

## 集合导向的多租户

实现集合导向的多租户有两种可能的方法。

### 所有租户使用一个集合

通过添加一个租户字段来区分租户，使用单个集合来实现多租户是一个简单的选项。在为特定租户进行 ANN 搜索时，添加一个过滤表达式以过滤掉属于其他租户的所有实体。这是实现多租户的最简单的方法。然而，请注意，过滤性能可能会成为 ANN 搜索的瓶颈。

### 每个租户一个集合

另一种方法是为每个租户创建一个集合来存储他们自己的数据，而不是将所有租户的数据存储在单个集合中。这提供了更好的数据隔离和查询性能。然而，请注意，这种方法需要更多的资源调度、运营能力和成本投资，如果租户数量超过了单个 Milvus 集群支持的最大集合数，则可能不适用。

## 分区导向的多租户

实现分区导向的多租户也有两种可能的方法：

### 每个租户一个分区

管理单个集合比管理多个集合要容易得多。而不是创建多个集合，考虑为每个租户分配一个分区以实现灵活的数据隔离和内存管理。分区导向的多租户的搜索性能远远优于集合导向的多租户。然而，请注意，集合的租户数量不应超过一个集合可以持有的最大分区数。

### 基于分区键的多租户

Milvus 2.2.9 引入了一个名为分区键的新特性。在创建集合时，指定一个租户字段并将其作为分区键字段。Milvus 将根据分区键字段中的值将实体存储在分区中。在进行 ANN 搜索时，Milvus 根据指定的分区键更改为分区，根据分区键过滤实体，并在过滤后的实体中进行搜索。

<div class="alert note">

一旦你为集合设置了分区键，你就不能批量插入实体到集合中。

</div>

这种策略提高了 Milvus 集合可以支持的最大租户数量的限制，并大大简化了资源管理，因为 Milvus 自动为你管理分区。

总之，你可以使用上述一个或多个多租户策略来形成你自己的解决方案。下面的表格比较了这些策略在数据隔离、搜索性能和最大租户数量方面的不同。

|                      | 数据隔离 | 搜索性能 | 最大租户数量 | 推荐场景                                                             |
| -------------------- | -------- | -------- | ------------ | -------------------------------------------------------------------- |
| 数据库导向的         | 强       | 强       | 64           | 对于那些需要集合随项目变化的人，特别适合于组织内部门之间的数据隔离。 |
| 所有租户使用一个集合 | 弱       | 中等     | N/A          | 对于那些资源有限且对数据隔离不敏感的人。                             |
| 每个租户一个集合     | 强       | 强       | 少于 10,000  | 对于那些每个集群有少于 10,000 个租户的人。                           |
| 每个租户一个分区     | 中等     | 强       | 4,096        | 对于那些每个集合有少于 4,096 个租户的人。                            |
| 基于分区键的         | 中等     | 强       | 10,000,000+  | 对于那些预计租户数量会迅速增加到百万的人。                           |

## 接下来

[管理数据库](manage_databases.md)
[模式](schema.md)
