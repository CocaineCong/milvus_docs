# GPU索引

Milvus支持多种GPU索引类型，以加速搜索性能和效率，特别是在高吞吐量、低延迟和高召回率的场景中。本主题提供了Milvus支持的GPU索引类型的概述，它们的适用用例以及性能特性。有关使用GPU构建索引的信息，请参考[Index with GPU](index-with-gpu.md)。

GPU加速可以大大提高Milvus的搜索性能和效率，特别是在高吞吐量、低延迟和高召回率的场景中，并且对大型nq批处理搜索场景也非常友好。

![performance](/gpu_index.png)

Milvus的GPU支持由Nvidia [RAPIDS](https://rapids.ai/)团队提供。以下是Milvus当前支持的GPU索引类型。

## GPU_CAGRA

GPU_CAGRA是基于图的索引，针对GPU进行了优化，在推理GPU上表现良好。它最适合查询数量较少的情况，在这种情况下，使用较低内存频率训练GPU可能无法获得最佳结果。

- 索引构建参数

  | 参数                         | 描述                                                                                                                                                                                                                                                                                                                                                                                     | 默认值            |
   |-----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
   | `intermediate_graph_degree` | 通过确定修剪前图的度数，影响召回率和构建时间。推荐值是`32`或`64`。                                                                                                                                                                                                                                                                                                                | <code>128</code>     |
   | `graph_degree`              | 通过设置修剪后图的度数，影响搜索性能和召回率。这两个度数之间的差异越大，构建时间越长。它的值必须小于__intermediate_graph_degree__的值。                                                                                                                                                                                                                                   | <code>64</code>      |
   | `build_algo`                | 选择修剪前图生成算法。可能的值：</br><code>IVF_PQ</code>：提供更高的质量，但构建时间更慢。</br> <code>NN_DESCENT</code>：提供更快的构建，但可能召回率较低。                             | <code>IVF_PQ</code>  |
   | `cache_dataset_on_device`   | 决定是否在GPU内存中缓存原始数据集。可能的值：</br><code>"true"</code>：缓存原始数据集以通过细化搜索结果提高召回率。</br> <code>"false"</code>：不缓存原始数据集以节省内存。 | <code>"false"</code> |

- 搜索参数

    | 参数                           | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                  | 默认值 |
    |-------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------|
    | `itopk_size`                        | 确定搜索期间保留的中间结果的大小。较大的值可能会提高召回率，但可能会影响搜索性能。它应该至少等于最终的top-k（限制）值，并且通常是2的幂（例如，16, 32, 64, 128）。                                              | Empty         |
    | `search_width`                      | 指定搜索期间进入CAGRA图的入口点数量。增加此值可以提高召回率，但可能会影响搜索性能。                                                                                                                                                     | Empty         |
    | `min_iterations` / `max_iterations` | 控制搜索迭代过程。默认情况下，它们设置为`0`，并且CAGRA根据`itopk_size`和`search_width`自动确定迭代次数。手动调整这些值可以帮助平衡性能和准确性。                                                       | `0`             |
    | `team_size`                         | 指定用于在GPU上计算度量距离的CUDA线程数量。常见值是2的幂，最高可达32（例如2, 4, 8, 16, 32）。它对搜索性能有轻微影响。默认值是`0`，Milvus根据向量维度自动选择`team_size`。 | `0`             |


## GPU_IVF_FLAT

与[IVF_FLAT](https://milvus.io/docs/index.md#IVF_FLAT)类似，GPU_IVF_FLAT也将向量数据分成`nlist`个簇单元，然后比较目标输入向量和每个簇的中心之间的距离。根据系统设置的要查询的簇数量（`nprobe`），仅基于目标输入和最相似簇中的向量之间的比较返回相似性搜索结果，从而大大减少了查询时间。

通过调整`nprobe`，可以在给定场景中找到准确性和速度之间的理想平衡。来自[IVF_FLAT性能测试](https://zilliz.com/blog/Accelerating-Similarity-Search-on-Really-Big-Data-with-Vector-Indexing)的结果表明，随着目标输入向量（`nq`）的数量和要搜索的簇（`nprobe`）的数量的增加，查询时间急剧增加。

GPU_IVF_FLAT是最基础的IVF索引，每个单元中