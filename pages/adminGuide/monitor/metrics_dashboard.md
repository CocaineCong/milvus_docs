---
id: metrics_dashboard.md
title: Milvus 指标仪表板
summary: 本主题介绍 Milvus 仪表板中显示的监控指标。
---

# Milvus 指标仪表板

Milvus 在运行时输出了一系列详细的时序指标。您可以使用 [Prometheus](https://https://prometheus.io/) 和 [Grafana](https://grafana.com/) 来可视化这些指标。本文介绍在 Grafana Milvus 仪表板中显示的监控指标。

本文中的时间单位是毫秒。而“99 百分位数”指的是在一定值内控制了 99% 的时间统计数据。

我们建议先阅读 [Milvus 监控框架概览](monitor_overview.md) 来了解 Prometheus 指标。

<details><summary>代理</summary>

| 面板 | 面板描述 | Prometheus 查询语言 (PromQL) | 使用的 Milvus 指标 | Milvus 指标描述 |
|---|---|---|---|---|
| 搜索向量计数率 | 过去两分钟内每个代理每秒查询的平均向量数。 | ``` sum(increase(milvus_proxy_search_vectors_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])/120) by (pod, node_id) ``` | `milvus_proxy_search_vectors_count` | 查询的向量累积数量。 |
| 插入向量计数率 | 过去两分钟内每个代理每秒插入的平均向量数。 | ``` sum(increase(milvus_proxy_insert_vectors_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])/120) by (pod, node_id) ``` | `milvus_proxy_insert_vectors_count` | 插入的向量累积数量。 |
| 搜索延迟 | 过去两分钟内每个代理接收搜索和查询请求的平均延迟和 99 百分位数延迟。 | p99:  <br/>  ``` histogram_quantile(0.99, sum by (le, query_type, pod, node_id) (rate(milvus_proxy_sq_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m]))) ```  <br/>  avg:  <br/>  ``` sum(increase(milvus_proxy_sq_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, query_type) / sum(increase(milvus_proxy_sq_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, query_type) ``` | `milvus_proxy_sq_latency` | 搜索和查询请求的延迟。 |
| 集合搜索延迟 | 过去两分钟内每个代理接收特定集合的搜索和查询请求的平均延迟和99百分位数延迟。 | p99: <br/> ```histogram_quantile(0.99, sum by (le, query_type, pod, node_id) (rate(milvus_proxy_collection_sq_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", collection_name=~"$collection"}[2m])))``` <br/> avg: <br/>  ```sum(increase(milvus_proxy_collection_sq_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", collection_name=~"$collection"}[2m])) by (pod, node_id, query_type) / sum(increase(milvus_proxy_collection_sq_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", collection_name=~"$collection"}[2m])) by (pod, node_id, query_type)``` | `milvus_proxy_collection_sq_latency_sum` | 特定集合的搜索和查询请求的延迟 |
| 变更延迟 | 过去两分钟内，每个代理接收到特定集合的搜索和查询请求的平均延迟和第99百分位延迟。 | p99: <br/> ```histogram_quantile(0.99, sum by (le, query_type, pod, node_id) (rate(milvus_proxy_collection_sq_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", collection_name=~"$collection"}[2m])))``` <br/> avg: <br/> ```sum(increase(milvus_proxy_collection_sq_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", collection_name=~"$collection"}[2m])) by (pod, node_id, query_type) / sum(increase(milvus_proxy_collection_sq_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", collection_name=~"$collection"}[2m])) by (pod, node_id, query_type)``` | `milvus_proxy_collection_sq_latency_sum` | 特定集合的搜索和查询请求延迟 |
| 突变请求变更延迟 | 过去两分钟内，每个代理接收突变请求的平均延迟和99百分位数延迟。 | p99: <br/> ```histogram_quantile(0.99, sum by (le, msg_type, pod, node_id) (rate(milvus_proxy_mutation_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])))``` <br/> avg: <br/> ```sum(increase(milvus_proxy_mutation_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, msg_type) / sum(increase(milvus_proxy_mutation_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, msg_type)``` | `milvus_proxy_mutation_latency_sum` | 突变请求的延迟 |
| 集合变更延迟 | 过去两分钟内，每个代理接收特定集合的突变请求的平均延迟和99百分位数延迟。 | p99: <br/> ```histogram_quantile(0.99, sum by (le, query_type, pod, node_id) (rate(milvus_proxy_collection_sq_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", collection_name=~"$collection"}[2m])))``` <br/> avg: <br/> ```sum(increase(milvus_proxy_collection_sq_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", collection_name=~"$collection"}[2m])) by (pod, node_id, query_type) / sum(increase(milvus_proxy_collection_sq_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", collection_name=~"$collection"}[2m])) by (pod, node_id, query_type)``` | `milvus_proxy_collection_sq_latency_sum` | 特定集合的突变请求延迟 |
| 等待搜索结果延迟 | 过去两分钟内，代理发送搜索和查询请求与接收结果之间的平均延迟和99百分位数延迟。 | p99: <br/>  ```histogram_quantile(0.99, sum by (le, query_type, pod, node_id) (rate(milvus_proxy_sq_wait_result_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])))``` <br/> avg: <br/>  ```sum(increase(milvus_proxy_sq_wait_result_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, query_type) / sum(increase(milvus_proxy_sq_wait_result_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, query_type)``` | `milvus_proxy_sq_wait_result_latency` | 发送搜索和查询请求与接收结果之间的延迟 |
| 减少搜索结果延迟 | 过去两分钟内，代理聚合搜索和查询结果的平均延迟和99百分位数延迟。 | p99: <br/>  ```histogram_quantile(0.99, sum by (le, query_type, pod, node_id) (rate(milvus_proxy_sq_reduce_result_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])))``` <br/> avg: <br/>  ```sum(increase(milvus_proxy_sq_reduce_result_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, query_type) / sum(increase(milvus_proxy_sq_reduce_result_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, query_type)``` | `milvus_proxy_sq_reduce_result_latency` | 每个查询节点返回的搜索和查询结果的聚合延迟 |
| 解码搜索结果延迟 | 过去两分钟内，代理解码搜索和查询结果的平均延迟和99百分位数延迟。 | p99: <br/>  ```histogram_quantile(0.99, sum by (le, query_type, pod, node_id) (rate(milvus_proxy_sq_decode_result_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])))``` <br/> avg: <br/>  ```sum(increase(milvus_proxy_sq_decode_result_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, query_type) / sum(increase(milvus_proxy_sq_decode_resultlatency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, query_type)``` | `milvus_proxy_sq_decode_result_latency` | 解码每个搜索和查询结果的延迟 |
| 消息流对象数量 | 过去两分钟内，每个代理在其相应物理主题上创建的消息流对象的平均数量、最大数量和最小数量。 | ```avg(milvus_proxy_msgstream_obj_num{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}) by (pod, node_id) max(milvus_proxy_msgstream_obj_num{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}) by (pod, node_id) min(milvus_proxy_msgstream_obj_num{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}) by (pod, node_id)``` | `milvus_proxy_msgstream_obj_num` | 在每个物理主题上创建的消息流对象的数量 |
| 变更发送延迟| 过去两分钟内，每个代理发送插入或删除请求的平均延迟和99百分位数延迟。 | p99: <br/>  ```histogram_quantile(0.99, sum by (le, msg_type, pod, node_id) (rate(milvus_proxy_mutation_send_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])))``` <br/> avg: <br/>  ```sum(increase(milvus_proxy_mutation_send_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, msg_type) / sum(increase(milvus_proxy_mutation_send_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, msg_type)``` | `milvus_proxy_mutation_send_latency` | 发送插入或删除请求的延迟 |
| 缓存命中率 | 过去两分钟内，包括 `GeCollectionID`、`GetCollectionInfo` 和 `GetCollectionSchema` 操作的每秒平均缓存命中率。 | ```sum(increase(milvus_proxy_cache_hit_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", cache_state="hit"}[2m])/120) by(cache_name, pod, node_id) / sum(increase(milvus_proxy_cache_hit_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])/120) by(cache_name, pod, node_id)``` | `milvus_proxy_cache_hit_count` | 每个缓存读取操作的命中和失败率的统计 |
| 缓存更新延迟 | 过去两分钟内，代理的缓存更新延迟的平均值和99百分位数。 | p99: <br/>  ```histogram_quantile(0.99, sum by (le, pod, node_id) (rate(milvus_proxy_cache_update_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])))``` <br/> avg: <br/>  ```sum(increase(milvus_proxy_cache_update_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id) / sum(increase(milvus_proxy_cache_update_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id)``` | `milvus_proxy_cache_update_latency` | 每次更新缓存的延迟 |
| 同步时间 | 每个代理在各自物理通道中同步的纪元时间（Unix 时间，自1970年1月1日以来的毫秒数）的平均值、最大值和最小值。 | ```avg(milvus_proxy_sync_epoch_time{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}) by (pod, node_id) max(milvus_proxy_sync_epoch_time{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}) by (pod, node_id) min(milvus_proxy_sync_epoch_time{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}) by (pod, node_id)``` | `milvus_proxy_sync_epoch_time` | 每个物理通道的纪元时间 |
| 主键延迟 | 过去两分钟内，每个代理应用主键的平均延迟和99百分位数延迟。 | p99: <br/>  ```histogram_quantile(0.99, sum by (le, pod, node_id) (rate(milvus_proxy_apply_pk_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])))``` <br/> avg: <br/>  ```sum(increase(milvus_proxy_apply_pk_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id) / sum(increase(milvus_proxy_apply_pk_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id)``` | `milvus_proxy_apply_pk_latency` | 应用主键的延迟 |
| 时间戳延迟 | 过去两分钟内，每个代理应用时间戳的平均延迟和99百分位数延迟。 | p99: <br/>  ```histogram_quantile(0.99, sum by (le, pod, node_id) (rate(milvus_proxy_apply_timestamp_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])))``` <br/> avg: <br/>  ```sum(increase(milvus_proxy_apply_timestamp_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id) / sum(increase(milvus_proxy_apply_timestamp_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id)``` | `milvus_proxy_apply_timestamp_latency` | 应用时间戳的延迟 |
| 成功请求数量 | 每个代理每秒接收的成功请求的数量，以及每种请求类型的详细细分。可能的请求类型包括 DescribeCollection、DescribeIndex、GetCollectionStatistics、HasCollection、Search、Query、ShowPartitions、Insert 等。 | ```sum(increase(milvus_proxy_req_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", status="success"}[2m])/120) by(function_name, pod, node_id)``` | `milvus_proxy_req_count` | 接收的所有类型请求的数量 |
| 失败请求数量 | 每个代理每秒接收的失败请求的数量，以及每种请求类型的详细细分。可能的请求类型包括 DescribeCollection、DescribeIndex、GetCollectionStatistics、HasCollection、Search、Query、ShowPartitions、Insert 等。 | ```sum(increase(milvus_proxy_req_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace", status="fail"}[2m])/120) by(function_name, pod, node_id)``` | `milvus_proxy_req_count` | 接收的所有类型请求的数量 |
| 请求延迟 | 过去两分钟内，每个代理接收的所有类型请求的平均延迟和99百分位数延迟。 | p99: <br/> ```histogram_quantile(0.99, sum by (le, pod, node_id, function_name) (rate(milvus_proxy_req_latency_bucket{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])))``` <br/> avg: <br/> ```sum(increase(milvus_proxy_req_latency_sum{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, function_name) / sum(increase(milvus_proxy_req_latency_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])) by (pod, node_id, function_name)``` | `milvus_proxy_req_latency` | 接收的所有类型请求的延迟 |
| 插入和删除请求的字节数 | 过去两分钟内，代理每秒接收的插入和删除请求的字节数。 | ```sum(increase(milvus_proxy_receive_bytes_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])/120) by(pod, node_id)``` | `milvus_proxy_receive_bytes_count` | 插入和删除请求的数量 |
| 发送回客户端的字节数 | 过去两分钟内，每个代理在响应搜索和查询请求时发送回客户端的字节数每秒。 | ```sum(increase(milvus_proxy_send_bytes_count{app_kubernetes_io_instance=~"$instance", app_kubernetes_io_name="$app_name", namespace="$namespace"}[2m])/120) by(pod, node_id)``` | `milvus_proxy_send_bytes_count` | 每个代理在响应搜索和查询请求时发送回客户端的字节数 |


