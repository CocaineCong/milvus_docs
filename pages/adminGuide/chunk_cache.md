---

id: chunk_cache.md
title: 配置块缓存
---

# 配置块缓存

块缓存机制使 Milvus 能够在查询节点的本地硬盘上预先将数据加载到缓存中，以便在需要时使用。这种机制通过减少从磁盘到内存加载数据所需的时间，显著提高了向量检索性能。

## 背景

在执行检索向量的查询之前，Milvus 需要将数据从对象存储加载到查询节点的本地硬盘上的记忆缓存中。这是一个耗时的过程。在所有数据加载完成之前，Milvus 可能会延迟响应一些向量检索请求。

为了提高查询性能，Milvus 提供了一个块缓存机制，以便在需要之前预先将数据从对象存储加载到本地硬盘上的缓存中。当收到查询请求时，Segcore 首先检查数据是否在缓存中，而不是在对象存储中。如果数据在缓存中，Segcore 可以快速从缓存中检索数据并将结果返回给客户端。

## 配置块缓存

本指南提供了如何为 Milvus 实例配置块缓存机制的说明。配置因安装 Milvus 实例的方式而异。

- 对于使用 Helm 图表安装的 Milvus 实例

  将配置添加到 `values.yaml` 文件下的 `config` 部分。有关详细信息，请参阅 [使用 Helm 图表配置 Milvus](configure-helm.md)。

- 对于使用 Docker Compose 安装的 Milvus 实例

  将配置添加到启动 Milvus 实例时使用的 `milvus.yaml` 文件中。有关详细信息，请参阅 [使用 Docker Compose 配置 Milvus](configure-docker.md)。

- 对于使用 Operator 安装的 Milvus 实例

  将配置添加到 `Milvus` 自定义资源的 `spec.components` 部分。有关详细信息，请参阅 [使用 Operator 配置 Milvus](configure_operator.md)。

### 配置选项

```yaml
queryNode:
    cache:
        warmup: async
```

`warmup` 参数确定 Milvus 是否在需要之前预先从对象存储加载数据到查询节点的本地硬盘上的缓存中。此参数默认为 `async`。可能的选项如下：

- `async`: Milvus 在后台异步预加载数据，这不会影加载集合所需的时间。然而，用户在加载过程完成后的短时间内检索向量时可能会经历延迟。这是默认选项。
- `sync`: Milvus 同步预加载数据，这可能会影响加载集合所需的时间。然而，用户可以在加载过程完成后立即执行查询，没有任何延迟。
- `off`: Milvus 不会预先将数据加载到内存缓存中。

请注意，当新数据插入集合或重建集合索引时，块缓存设置也适用。

### 常见问题解答

- **我如何确定块缓存机制是否正常工作？**

   建议在加载集合后检查搜索或查询请求的延迟。如果延迟明显高于预期（例如，几秒钟），可能表明块缓存机制仍在工作。

    如果查询延迟长时间保持高位。您可以检查对象存储的吞吐量以确保块缓存仍在工作。在正常情况下，工作的块缓存会在对象存储上产生高吞吐量。或者，您可以尝试在 `sync` 模式下使用块缓存。